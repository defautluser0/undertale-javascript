<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UNDERTALE</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <canvas id="gameCanvas" width="640" height="480"></canvas>
  <script type="module">
    import roomSize from '/imports/assets/roomSize.js'

    roomSize.width = 320;  // room width in px
    roomSize.height = 240; // room height in px

  </script>
  <script src="/imports/howler.js"></script>
  <script type="module">
    import { control_update, input_update } from "/imports/input.js";
    import * as objectname from '/obj/objectname/index.js'

    const objectnameInstance = objectname.create();

    objectnameInstance.x = 0; // edit as necessary
    objectnameInstance.y = 0; // edit as necessary

    // room start
    objectname.roomStart.call(objectnameInstance);

    // gameloop DO NOT EDIT VARIABLES UNLESS NECESSARY (eg. changing fps in this room for some reason)
    // IMPORTANT: replace "objectname" with the object name (eg. mainchara) and import it from /obj/objectname/index.js as seen above
    const FPS = 30;
    const FRAME_DURATION = 1000 / FPS;
    let lastFrameTime = 0;
    function game_loop(currentTime) {
      const elapsed = currentTime - lastFrameTime;

      if (elapsed >= FRAME_DURATION) {
        lastFrameTime = currentTime;

        control_update();
        // object functions that run every frame go here
        objectname.beginStep.call(objectnameInstance);
        objectname.step.call(objectnameInstance);
        objectname.endStep.call(objectnameInstance);
        objectname.draw.call(objectnameInstance);
        // end of object functions section
        input_update();

        if (global.roomEnd && !global.eventDone) {
          global.eventDone = true;
          // roomEnd() code
          objectname.roomEnd.call(objectnameinstance);
        }

        if (global.roomEnd && global.eventDone) {
          global.eventDone = false;
          window.location.href = global.nextRoom;
        }
      }

      requestAnimationFrame(game_loop);
    }

    // room code (object positioning and such) goes here

    // starts the game loop once everything has been defined
    window.addEventListener('load', () => {
      requestAnimationFrame(game_loop);
    })
  </script>
</body>

</html>